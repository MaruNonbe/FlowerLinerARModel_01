<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>AR Train WebAR</title>

  <!-- A-Frame + AR.js -->
  <script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
  <script src="https://cdn.jsdelivr.net/gh/AR-js-org/AR.js/aframe/build/aframe-ar.js"></script>

  <style>
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      overflow: hidden;
      background: #000; /* 初期黒背景（カメラ映像で置き換えられる） */
    }

    a-scene {
      position: fixed !important;
      top: 0;
      left: 0;
      width: 100% !important;
      height: 100% !important;
    }

    #ui {
      position: fixed;
      bottom: 10px;
      width: 100%;
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 5px;
      z-index: 9999;
      pointer-events: auto;
    }

    .btn {
      min-width: 60px;
      padding: 8px 10px;
      text-align: center;
      font-size: 16px;
      background: rgba(255,255,255,0.9);
      border-radius: 6px;
      border: 1px solid #222;
      cursor: pointer;
      user-select: none;
    }
  </style>
</head>

<body>

<!-- ★★★ カメラ映像が最初から出るための最低構成 ★★★ -->
<a-scene
  embedded
  arjs="sourceType: webcam; debugUIEnabled: false;"
  vr-mode-ui="enabled: false"
>
  <!-- Markers + Train Model -->
  <a-marker-camera preset="hiro">
    <a-entity id="train"
      gltf-model="models/AR-Train_Nagai.glb"
      position="0 0 -1"
      rotation="0 0 0"
      scale="0.5 0.5 0.5">
    </a-entity>
  </a-marker-camera>
</a-scene>

<!-- UI -->
<div id="ui">
  <div class="btn" id="btn-forward">↑</div>
  <div class="btn" id="btn-backward">↓</div>
  <div class="btn" id="btn-left">←</div>
  <div class="btn" id="btn-right">→</div>
</div>

<script>
/* 方向ボタン処理（動作確認用の最小コード） */
const train = document.querySelector("#train");
const moving = { forward:false, backward:false, left:false, right:false };

function moveTrain() {
  const obj = train.object3D;

  if (moving.forward) obj.position.z -= 0.05;
  if (moving.backward) obj.position.z += 0.05;
  if (moving.left) obj.rotation.y += 0.05;
  if (moving.right) obj.rotation.y -= 0.05;

  if (moving.forward || moving.backward || moving.left || moving.right)
    requestAnimationFrame(moveTrain);
}

function setupButton(id, key){
  const btn = document.getElementById(id);
  btn.onmousedown = () => { moving[key] = true; moveTrain(); };
  btn.onmouseup   = () => { moving[key] = false; };
  btn.ontouchstart = e => { e.preventDefault(); moving[key] = true; moveTrain(); };
  btn.ontouchend   = () => { moving[key] = false; };
}

setupButton("btn-forward","forward");
setupButton("btn-backward","backward");
setupButton("btn-left","left");
setupButton("btn-right","right");
</script>

</body>
</html>
